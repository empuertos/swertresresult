<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Sheet Data</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      background: #0f111a;
      color: #e6ecff;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      padding: 1rem;
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
    }
    .card {
      background: #1f2435;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      box-shadow: 0 24px 60px -10px rgba(0,0,0,.25);
      max-width: 1100px;
      width: 100%;
      overflow: auto;
    }
    h1 {
      margin: 0 0 .5rem;
      font-size: 1.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: .5rem;
    }
    thead tr {
      background: #2f3045;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #272a48;
      text-align: left;
      white-space: nowrap;
    }
    th {
      position: sticky;
      top: 0;
      font-weight: 600;
    }
    tr:nth-child(odd) {
      background: rgba(255,255,255,.02);
    }
    .small {
      font-size: .7rem;
      opacity: .75;
    }
    .error {
      background: #7a1f1f;
      padding: .75rem 1rem;
      border-radius: .5rem;
      color: #ffe3e3;
      margin-top: .5rem;
    }
    .loading {
      display: inline-block;
      font-size: .9rem;
      margin-left: .5rem;
      vertical-align: middle;
    }
    .refresh {
      background: #6366f1;
      border: none;
      color: white;
      padding: .45rem .9rem;
      border-radius: .5rem;
      cursor: pointer;
      font-size: .8rem;
      margin-left: .5rem;
    }
    .timestamp {
      margin-top: .5rem;
      font-size: .65rem;
      opacity: .8;
    }
  </style>
</head>
<body>
  <div class="card" aria-label="Live spreadsheet data">
    <div style="display:flex; align-items:center; justify-content: space-between; flex-wrap: wrap; gap:8px;">
      <div>
        <h1>Live Sheet Data</h1>
        <div class="small">Automatically refreshed every 30 seconds.</div>
      </div>
      <div>
        <button class="refresh" id="manualRefresh">Refresh now</button>
        <span id="status" class="small"></span>
      </div>
    </div>
    <div id="tableContainer" aria-live="polite">
      <div class="loading" id="loadingText">Loading data…</div>
    </div>
    <div class="timestamp" id="lastUpdated"></div>
    <div id="errorMsg" class="error" style="display:none;"></div>
  </div>

  <script>
    // === CONFIGURE THIS: your published CSV URL ===
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYsjd9JYHYMW-UQipV00EObQWZyER01Cj0LCOwwkq1TFlg0lBjmTmZVUFDXPvyb-y2zqXW2pzskL-5/pub?output=csv&gid=0";
    // ============================================

    const tableContainer = document.getElementById("tableContainer");
    const errorMsg = document.getElementById("errorMsg");
    const lastUpdated = document.getElementById("lastUpdated");
    const status = document.getElementById("status");
    const loadingText = document.getElementById("loadingText");
    const manualRefresh = document.getElementById("manualRefresh");

    let refreshIntervalId = null;

    function parseCSV(text) {
      const rows = text.trim().split("\n").map(r => {
        // naive CSV split; for more robust parsing you could integrate a small parser
        return r.split(",").map(c => c.replace(/^"|"$/g, ""));
      });
      return rows;
    }

    function buildTable(data) {
      if (!data || data.length === 0) {
        tableContainer.innerHTML = "<div class='small'>No data available.</div>";
        return;
      }
      const thead = data[0];
      const bodyRows = data.slice(1);

      const table = document.createElement("table");
      const trHead = document.createElement("tr");
      thead.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        trHead.appendChild(th);
      });
      const theadEl = document.createElement("thead");
      theadEl.appendChild(trHead);
      table.appendChild(theadEl);

      const tbody = document.createElement("tbody");
      bodyRows.forEach(row => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      tableContainer.innerHTML = "";
      tableContainer.appendChild(table);
    }

    async function fetchAndRender() {
      status.textContent = "Fetching…";
      errorMsg.style.display = "none";
      loadingText.style.display = "inline-block";
      try {
        const resp = await fetch(CSV_URL, { cache: "no-cache" });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const text = await resp.text();
        const parsed = parseCSV(text);
        buildTable(parsed);
        const now = new Date();
        lastUpdated.textContent = "Last updated: " + now.toLocaleString("en-US", { hour12: true });
        status.textContent = "";
      } catch (err) {
        errorMsg.textContent = "Failed to load spreadsheet: " + err.message;
        errorMsg.style.display = "block";
        status.textContent = "Error";
      } finally {
        loadingText.style.display = "none";
      }
    }

    manualRefresh.addEventListener("click", () => {
      fetchAndRender();
    });

    // initial load
    fetchAndRender();
    // periodic refresh every 30s
    refreshIntervalId = setInterval(fetchAndRender, 30000);
  </script>
</body>
</html>
